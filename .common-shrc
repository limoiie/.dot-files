# >>> shared customization >>>
# Inspect commands
EMX_EXISTS=$(command -v emacs)
NVI_EXISTS=$(command -v nvim)
EXA_EXISTS=$(command -v exa)
FZF_EXISTS=$(command -v fzf)
BAT_EXISTS=$(command -v bat)
GIT_EXISTS=$(command -v git)
RGP_EXISTS=$(command -v rg)

# Environments
export XDG_CONFIG_HOME=~/.config

# Relocate .vimrc file
export VIMINIT="source ${XDG_CONFIG_HOME}/vim/vimrc"

# fzf options
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border --bind="ctrl-k:kill-line,ctrl-v:page-down,alt-v:page-up,alt-n:preview-page-down,alt-p:preview-page-up"'
export FZF_COMPLETION_TRIGGER='..'

# using bat for man
[ -x "${BAT_EXISTS}" ] && export MANPAGER="sh -c 'col -bx | bat -l man -p'"

# Alias
[ -x "${EXA_EXISTS}" ] && alias ls="exa"
[ -x "${EMX_EXISTS}" ] && alias  e="emacs"
[ -x "${EMX_EXISTS}" ] && alias et="emacs -nw"
[ -x "${EMX_EXISTS}" ] && alias en="emacs -nw"
[ -x "${EMX_EXISTS}" ] && alias ec="emacsclient -a '' -c"
[ -x "${NVI_EXISTS}" ] && alias  v="nvim"
[ -x "${NVI_EXISTS}" ] && alias vi="nvim"

alias la="ls -a"
alias ll="ls -al"
alias j1=%1
alias j2=%2
alias j3=%3
alias j4=%4
alias j5=%5

# activate cargo
[ -f "~/.cargo/env" ] && . ~/.cargo/env

# disable proxy
proxy_off() {
    unset http_proxy
    unset https_proxy
    unset ftp_proxy
    unset rsync_proxy
    echo -e "Proxy is disabled"
}

# enable proxy
proxy_on() {
    export no_proxy="localhost,127.0.0.1,localaddress,.localdomain.com"
    export http_proxy="http://127.0.0.1:7890"
    export https_proxy=$http_proxy
    export ftp_proxy=$http_proxy
    export rsync_proxy=$http_proxy
    echo -e "Proxy is enabled on $http_proxy!"
}

# remove all the emacs swap files under current folder
clean_emacs_cache() {
    rm .*~
}

# Boost z with fzf
[ -x "${FZF_EXISTS}" ] && \
    zf() {
        dir=$(z -l | tac | fzf | awk '{ $1="" }1' | sed 's/^ *//')
        if [[ -d "$dir" ]]; then
            cd $dir
        fi
    }

# Call fzf with bat as preview
[ -x "${FZF_EXISTS}" ] && [ -x "${BAT_EXISTS}" ] && \
    fp() {
        preview="bat --color=always --style=numbers --line-range=:500 {}"
        fzf $@ --preview $preview
    }

# Beautified git-diff boosted with bat and fzf
[ -x "${FZF_EXISTS}" ] && [ -x "${GIT_EXISTS}" ] && \
    gdf() {
        # {-1} stands for the selected file
        preview="git diff $@ --color=always -- {-1}"
        git diff $@ --name-only | fzf -m --height=100% --preview $preview
    }

# Boost tail with bat
[ -x "${BAT_EXISTS}" ] && \
    bail() {
        tail $@ | bat --paging=never -l log
    }

# Boost rg with fzf
[ -x "${FZF_EXISTS}" ] && [ -x "${RGP_EXISTS}" ] && \
    rgf() {
        RGP_PREFIX="rg --column --line-number --no-heading --color=always --smart-case $@" \
                  INITIAL_QUERY="" FZF_DEFAULT_COMMAND="$RGP_PREFIX '$INITIAL_QUERY'" \
                  fzf --bind "change:reload:$RGP_PREFIX {q} || true" \
                  --ansi --query "$INITIAL_QUERY" \
                  --height=50% --layout=reverse
    }

# Goto the directory containing the selected file
[ -x "${FZF_EXISTS}" ] && \
     cdf() {
         cd $(fzf | xargs dirname)
     }
# <<< shared customization <<<
